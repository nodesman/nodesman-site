function initializeTopicsPage(){function e(e,t){function n(e){return void 0!==e.children&&e.children.length>0}void 0===t&&(t=r),a.empty();for(var o=0;o<e.length;o++){var l=e[o],c=$('<li class="top-level"><span><a class="name"></a><p class="description"></p></span></li>');if(c.find(".name").text(l.name),c.data("cat_id",l.id),0!=l.description.length?c.find(".description").text(l.description):$(c).find(".description").remove(),a.append(c),n(l)){var u=$('<ul class="second-level"></ul>');a.append(u),loopEnd=l.children.length>3?3:l.children.length;for(var o=0;o<loopEnd;o++){var d=$("<li></li>");d.text(l.children[o].name),d.data("cat_id",l.children[o].id),u.append(d)}l.children.length>3&&u.append($('<li class="more">More...</li>'))}}s.data("parent_cat_id",t),$(".left ul li").hoverIntent(i)}function t(e){var t={postList:e,category:"General"},i=$("#post_item").html();Mustache.parse(i);var n=Mustache.render(i,t);o.html(n),o.trigger("load-end")}function i(){var e=$(this);if(!e.hasClass("more")&&!e.hasClass("current")){$(".left ul li").removeClass("current"),e.addClass("current");var i=e.data("cat_id");void 0!==c&&null!==c&&c.abort(),c=$.get("/catlist",{cat_id:i},t,"json"),o.trigger("load-start")}}function n(e,t){for(var i=0;i<e.length;i++){var a=e[i];if(a.id===t)return a;if(void 0!==a.children&&a.children.length>0){var o=n(a.children,t);if(!1!==o)return o}}return!1}var a=$("ul.topics"),o=$(".right"),r=0,s=$(".left"),l=$(".back"),c=null,u=[];s.on("click",".back",function(){1!==u.length&&(u.pop(),1===u.length&&$(".back").hide(),e(u[u.length-1]))}),o.on("load-start",function(){$(this).addClass("loading")}),o.on("load-end",function(){$(this).removeClass("loading")}),s.delegate(".more","click",function(t){var i=t.target,a=$(i).parent().prev(),o=$(a).data("cat_id"),r=n(cat_hierarchy.catList,o);u.push(r.children),l.show(),e(r.children,o)}),"object"==typeof cat_hierarchy&&(e(cat_hierarchy.catList),u.push(cat_hierarchy.catList),i.call($(".left ul > li:nth-of-type(1)").get(0)));$(".left ul li")}$(document).ready(initializeTopicsPage);